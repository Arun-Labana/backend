
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A 45-day learning plan covering essential backend concepts with beginner-friendly notes and Java examples.">
      
      
      
        <link rel="canonical" href="https://Arun-Labana.github.io/backend/25.%20Distributed%20Locks/">
      
      
        <link rel="prev" href="../24.%20Dead%20Letter%20Queues/">
      
      
        <link rel="next" href="../26.%20Leader%20Election/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>25. Distributed Locks - 45 Days Backend Concepts</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#distributed-locks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="45 Days Backend Concepts" class="md-header__button md-logo" aria-label="45 Days Backend Concepts" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            45 Days Backend Concepts
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              25. Distributed Locks
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Arun-Labana/backend" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Arun-Labana/backend
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="45 Days Backend Concepts" class="md-nav__button md-logo" aria-label="45 Days Backend Concepts" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    45 Days Backend Concepts
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Arun-Labana/backend" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Arun-Labana/backend
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Days
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Days
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01.%20Connection%20Pooling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01. Connection Pooling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02.%20Idempotency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02. Idempotency
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03.%20Caching%20%28In-Memory%20vs%20Distributed%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    03. Caching (In-Memory vs Distributed)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04.%20Load%20Balancing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    04. Load Balancing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05.%20Rate%20Limiting%20%26%20Throttling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    05. Rate Limiting & Throttling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06.%20Horizontal%20vs%20Vertical%20Scaling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    06. Horizontal vs Vertical Scaling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07.%20Stateless%20vs%20Stateful%20Architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    07. Stateless vs Stateful Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08.%20Transactions%20%28ACID%20properties%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    08. Transactions (ACID properties)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09.%20Indexes%20%28B-Tree%2C%20Hash%2C%20etc.%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    09. Indexes (B-Tree, Hash, etc.)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10.%20Joins%20%26%20Query%20Optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    10. Joins & Query Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11.%20Normalization%20vs%20Denormalization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    11. Normalization vs Denormalization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12.%20Sharding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    12. Sharding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13.%20Replication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    13. Replication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../14.%20CAP%20Theorem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    14. CAP Theorem
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../15.%20REST%20APIs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    15. REST APIs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../16.%20GraphQL%20Basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    16. GraphQL Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../17.%20gRPC%20%26%20Protocol%20Buffers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    17. gRPC & Protocol Buffers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../18.%20WebSockets%20%28Realtime%20communication%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    18. WebSockets (Realtime communication)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../19.%20Message%20Queues%20%28RabbitMQ%2C%20Kafka%2C%20SQS%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    19. Message Queues (RabbitMQ, Kafka, SQS)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../20.%20Event-driven%20Architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    20. Event-driven Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../21.%20API%20Gateway/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    21. API Gateway
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../22.%20Circuit%20Breaker%20Pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    22. Circuit Breaker Pattern
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../23.%20Retry%20%26%20Backoff%20Strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    23. Retry & Backoff Strategies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../24.%20Dead%20Letter%20Queues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    24. Dead Letter Queues
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    25. Distributed Locks
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    25. Distributed Locks
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-are-distributed-locks" class="md-nav__link">
    <span class="md-ellipsis">
      What are Distributed Locks?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-distributed-locks-are-necessary" class="md-nav__link">
    <span class="md-ellipsis">
      Why Distributed Locks are Necessary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Why Distributed Locks are Necessary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preventing-race-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Preventing Race Conditions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensuring-single-instance-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Ensuring Single Instance Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-contention-management" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Contention Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maintaining-data-consistency" class="md-nav__link">
    <span class="md-ellipsis">
      Maintaining Data Consistency
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types-of-distributed-lock-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      Types of Distributed Lock Implementations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Types of Distributed Lock Implementations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-based-locks" class="md-nav__link">
    <span class="md-ellipsis">
      Database-Based Locks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redis-based-locks" class="md-nav__link">
    <span class="md-ellipsis">
      Redis-Based Locks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consensus-based-locks" class="md-nav__link">
    <span class="md-ellipsis">
      Consensus-Based Locks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-provider-locks" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Provider Locks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributed-lock-challenges" class="md-nav__link">
    <span class="md-ellipsis">
      Distributed Lock Challenges
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Distributed Lock Challenges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lock-expiration-and-timeouts" class="md-nav__link">
    <span class="md-ellipsis">
      Lock Expiration and Timeouts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split-brain-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      Split-Brain Scenarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-and-scalability" class="md-nav__link">
    <span class="md-ellipsis">
      Performance and Scalability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deadlock-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Deadlock Prevention
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Real-World Applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-World Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scheduled-job-coordination" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduled Job Coordination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-migration-coordination" class="md-nav__link">
    <span class="md-ellipsis">
      Database Migration Coordination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#critical-resource-access" class="md-nav__link">
    <span class="md-ellipsis">
      Critical Resource Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unique-identifier-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Unique Identifier Generation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-warming-and-data-loading" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Warming and Data Loading
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-distributed-lock-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Simple Distributed Lock Implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-interview-questions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Interview Questions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributed-lock-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Distributed Lock Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Distributed Lock Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#choose-appropriate-timeout-values" class="md-nav__link">
    <span class="md-ellipsis">
      Choose Appropriate Timeout Values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-lock-extension-for-long-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Lock Extension for Long Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-unique-identifiers-for-lock-ownership" class="md-nav__link">
    <span class="md-ellipsis">
      Use Unique Identifiers for Lock Ownership
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#design-for-lock-failure-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      Design for Lock Failure Scenarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitor-lock-usage-and-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor Lock Usage and Performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keep-critical-sections-small" class="md-nav__link">
    <span class="md-ellipsis">
      Keep Critical Sections Small
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../26.%20Leader%20Election/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    26. Leader Election
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../27.%20Consensus%20Algorithms%20%28Raft%2C%20Paxos%20basics%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    27. Consensus Algorithms (Raft, Paxos basics)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../28.%20Quorum%20in%20Databases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    28. Quorum in Databases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../29.%20Authentication%20vs%20Authorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    29. Authentication vs Authorization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../30.%20JWT%20%26%20OAuth2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    30. JWT & OAuth2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../31.%20CSRF%20%26%20XSS%20Protection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    31. CSRF & XSS Protection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../32.%20SQL%20Injection%20%26%20Prevention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    32. SQL Injection & Prevention
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../33.%20HTTPS%20%26%20TLS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    33. HTTPS & TLS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../34.%20CORS%20%28Cross-Origin%20Resource%20Sharing%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    34. CORS (Cross-Origin Resource Sharing)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../35.%20Hashing%20%26%20Password%20Storage%20%28bcrypt%2C%20Argon2%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    35. Hashing & Password Storage (bcrypt, Argon2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../36.%20Logging%20Strategies%20%28Structured%20Logging%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    36. Logging Strategies (Structured Logging)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../37.%20Metrics%20%26%20Monitoring%20%28Prometheus%2C%20Grafana%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    37. Metrics & Monitoring (Prometheus, Grafana)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../38.%20Tracing%20%28Distributed%20Tracing%2C%20OpenTelemetry%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    38. Tracing (Distributed Tracing, OpenTelemetry)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../39.%20Health%20Checks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    39. Health Checks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../40.%20Profiling%20%26%20Benchmarking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    40. Profiling & Benchmarking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../41.%20Error%20Handling%20Patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    41. Error Handling Patterns
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../42.%20Blue-Green%20%26%20Canary%20Deployments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    42. Blue-Green & Canary Deployments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../43.%20CQRS%20%28Command%20Query%20Responsibility%20Segregation%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    43. CQRS (Command Query Responsibility Segregation)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../44.%20Event%20Sourcing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    44. Event Sourcing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../45.%20Microservices%20vs%20Monoliths%20vs%20Serverless/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    45. Microservices vs Monoliths vs Serverless
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-are-distributed-locks" class="md-nav__link">
    <span class="md-ellipsis">
      What are Distributed Locks?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-distributed-locks-are-necessary" class="md-nav__link">
    <span class="md-ellipsis">
      Why Distributed Locks are Necessary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Why Distributed Locks are Necessary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preventing-race-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Preventing Race Conditions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensuring-single-instance-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Ensuring Single Instance Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-contention-management" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Contention Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maintaining-data-consistency" class="md-nav__link">
    <span class="md-ellipsis">
      Maintaining Data Consistency
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types-of-distributed-lock-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      Types of Distributed Lock Implementations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Types of Distributed Lock Implementations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-based-locks" class="md-nav__link">
    <span class="md-ellipsis">
      Database-Based Locks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redis-based-locks" class="md-nav__link">
    <span class="md-ellipsis">
      Redis-Based Locks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consensus-based-locks" class="md-nav__link">
    <span class="md-ellipsis">
      Consensus-Based Locks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-provider-locks" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Provider Locks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributed-lock-challenges" class="md-nav__link">
    <span class="md-ellipsis">
      Distributed Lock Challenges
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Distributed Lock Challenges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lock-expiration-and-timeouts" class="md-nav__link">
    <span class="md-ellipsis">
      Lock Expiration and Timeouts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split-brain-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      Split-Brain Scenarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-and-scalability" class="md-nav__link">
    <span class="md-ellipsis">
      Performance and Scalability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deadlock-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Deadlock Prevention
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Real-World Applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-World Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scheduled-job-coordination" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduled Job Coordination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-migration-coordination" class="md-nav__link">
    <span class="md-ellipsis">
      Database Migration Coordination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#critical-resource-access" class="md-nav__link">
    <span class="md-ellipsis">
      Critical Resource Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unique-identifier-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Unique Identifier Generation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-warming-and-data-loading" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Warming and Data Loading
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-distributed-lock-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Simple Distributed Lock Implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-interview-questions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Interview Questions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributed-lock-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Distributed Lock Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Distributed Lock Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#choose-appropriate-timeout-values" class="md-nav__link">
    <span class="md-ellipsis">
      Choose Appropriate Timeout Values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-lock-extension-for-long-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Lock Extension for Long Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-unique-identifiers-for-lock-ownership" class="md-nav__link">
    <span class="md-ellipsis">
      Use Unique Identifiers for Lock Ownership
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#design-for-lock-failure-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      Design for Lock Failure Scenarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitor-lock-usage-and-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor Lock Usage and Performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keep-critical-sections-small" class="md-nav__link">
    <span class="md-ellipsis">
      Keep Critical Sections Small
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/Arun-Labana/backend/edit/master/docs/25. Distributed Locks/README.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="distributed-locks">Distributed Locks<a class="headerlink" href="#distributed-locks" title="Permanent link">&para;</a></h1>
<h2 id="what-are-distributed-locks">What are Distributed Locks?<a class="headerlink" href="#what-are-distributed-locks" title="Permanent link">&para;</a></h2>
<p>Distributed locks are synchronization primitives that coordinate access to shared resources across multiple nodes or processes in a distributed system, ensuring that only one process can access a critical resource at any given time. Think of distributed locks like the reservation system for a single bathroom in a busy office building - multiple people might want to use it simultaneously, but the reservation system ensures that only one person has access at a time while others wait their turn. Without this coordination, you'd have conflicts and an unusable situation.</p>
<p>In distributed computing, multiple services or instances often need to access shared resources like databases, files, or external APIs that can only handle one operation at a time. Traditional thread-level locks that work within a single process are insufficient when coordination is needed across multiple servers or services. Distributed locks provide a way for processes running on different machines to coordinate access to these shared resources safely.</p>
<h2 id="why-distributed-locks-are-necessary">Why Distributed Locks are Necessary<a class="headerlink" href="#why-distributed-locks-are-necessary" title="Permanent link">&para;</a></h2>
<h3 id="preventing-race-conditions">Preventing Race Conditions<a class="headerlink" href="#preventing-race-conditions" title="Permanent link">&para;</a></h3>
<p>Race conditions occur when multiple processes attempt to modify the same resource simultaneously, leading to inconsistent or corrupted results. In distributed systems, these race conditions can have serious consequences because the processes are running on different machines and can't use traditional synchronization mechanisms.</p>
<p>Consider a scenario where multiple instances of a service need to process unique customer IDs. Without coordination, two instances might generate the same customer ID simultaneously, causing data integrity issues. Distributed locks prevent this by ensuring only one instance can generate IDs at a time.</p>
<h3 id="ensuring-single-instance-operations">Ensuring Single Instance Operations<a class="headerlink" href="#ensuring-single-instance-operations" title="Permanent link">&para;</a></h3>
<p>Many operations in distributed systems should only be performed by one instance at a time, even when multiple instances of a service are running. Examples include scheduled batch jobs, database migrations, cache warming operations, or sending critical notifications. Distributed locks ensure that these operations don't run concurrently across different instances.</p>
<h3 id="resource-contention-management">Resource Contention Management<a class="headerlink" href="#resource-contention-management" title="Permanent link">&para;</a></h3>
<p>Some shared resources, like external APIs with strict rate limits or legacy systems that can't handle concurrent access, require careful coordination. Distributed locks provide a way to serialize access to these resources, preventing overload and ensuring fair usage across multiple consuming services.</p>
<h3 id="maintaining-data-consistency">Maintaining Data Consistency<a class="headerlink" href="#maintaining-data-consistency" title="Permanent link">&para;</a></h3>
<p>In systems where multiple processes might update related data, distributed locks help maintain consistency by ensuring that related operations complete atomically from the perspective of the distributed system. While this doesn't provide ACID transaction guarantees across services, it does provide a higher level of coordination than uncoordinated access.</p>
<h2 id="types-of-distributed-lock-implementations">Types of Distributed Lock Implementations<a class="headerlink" href="#types-of-distributed-lock-implementations" title="Permanent link">&para;</a></h2>
<h3 id="database-based-locks">Database-Based Locks<a class="headerlink" href="#database-based-locks" title="Permanent link">&para;</a></h3>
<p>Database-based distributed locks use a shared database table to coordinate access across processes. A process acquires a lock by inserting or updating a record in a lock table, and releases the lock by deleting or updating the record. This approach leverages the database's transaction capabilities to ensure atomicity of lock operations.</p>
<p>Database locks are reliable and easy to implement, especially in systems that already depend on a shared database. However, they can create performance bottlenecks if many processes are competing for locks, and they introduce a dependency on database availability for lock operations.</p>
<h3 id="redis-based-locks">Redis-Based Locks<a class="headerlink" href="#redis-based-locks" title="Permanent link">&para;</a></h3>
<p>Redis-based locks use the atomic operations provided by Redis to implement distributed coordination. The most common approach uses the <code>SET</code> command with the <code>NX</code> (not exists) and <code>EX</code> (expiration) options to atomically set a key only if it doesn't already exist, with an automatic expiration time.</p>
<p>Redis locks are fast and efficient, with lower latency than database-based approaches. They also provide natural expiration mechanisms that help prevent deadlocks. However, they require additional infrastructure (Redis) and careful consideration of failure scenarios to ensure reliability.</p>
<h3 id="consensus-based-locks">Consensus-Based Locks<a class="headerlink" href="#consensus-based-locks" title="Permanent link">&para;</a></h3>
<p>Consensus-based locks use distributed consensus algorithms like Raft or Paxos to coordinate lock operations across multiple nodes. Systems like Apache ZooKeeper, etcd, or Consul provide distributed locking capabilities built on proven consensus algorithms.</p>
<p>These locks provide strong consistency guarantees and are highly reliable, even in the face of network partitions and node failures. However, they have higher implementation complexity and operational overhead compared to simpler approaches.</p>
<h3 id="cloud-provider-locks">Cloud Provider Locks<a class="headerlink" href="#cloud-provider-locks" title="Permanent link">&para;</a></h3>
<p>Cloud providers offer managed distributed locking services that handle the complexity of implementation and operation. Examples include AWS DynamoDB's conditional writes, Google Cloud Firestore transactions, or Azure Cosmos DB's optimistic concurrency control.</p>
<p>These services offload the operational burden but may have limitations in terms of performance characteristics or vendor lock-in considerations.</p>
<h2 id="distributed-lock-challenges">Distributed Lock Challenges<a class="headerlink" href="#distributed-lock-challenges" title="Permanent link">&para;</a></h2>
<h3 id="lock-expiration-and-timeouts">Lock Expiration and Timeouts<a class="headerlink" href="#lock-expiration-and-timeouts" title="Permanent link">&para;</a></h3>
<p>One of the biggest challenges in distributed locking is handling lock expiration. Locks must have timeouts to prevent deadlocks when lock holders crash or become unreachable. However, determining appropriate timeout values is difficult - too short and locks may expire while legitimate work is still in progress, too long and failed processes may hold locks for extended periods.</p>
<p>The challenge is compounded by network delays and clock skew between different machines. A process might think it still holds a lock while the lock has actually expired from the perspective of other processes.</p>
<h3 id="split-brain-scenarios">Split-Brain Scenarios<a class="headerlink" href="#split-brain-scenarios" title="Permanent link">&para;</a></h3>
<p>Network partitions can create situations where different parts of the system have different views of lock ownership. A process might believe it still holds a lock while another process has acquired the same lock due to network connectivity issues. This can lead to multiple processes believing they have exclusive access to a resource.</p>
<h3 id="performance-and-scalability">Performance and Scalability<a class="headerlink" href="#performance-and-scalability" title="Permanent link">&para;</a></h3>
<p>Distributed locks can become performance bottlenecks if not designed carefully. High contention for popular locks can create queuing effects that reduce overall system throughput. Additionally, the overhead of acquiring and releasing locks adds latency to operations.</p>
<h3 id="deadlock-prevention">Deadlock Prevention<a class="headerlink" href="#deadlock-prevention" title="Permanent link">&para;</a></h3>
<p>Deadlocks can occur when multiple processes wait for locks held by each other in a circular dependency. In distributed systems, detecting and resolving deadlocks is more complex than in single-process systems because the full system state isn't visible to any single process.</p>
<h2 id="real-world-applications">Real-World Applications<a class="headerlink" href="#real-world-applications" title="Permanent link">&para;</a></h2>
<h3 id="scheduled-job-coordination">Scheduled Job Coordination<a class="headerlink" href="#scheduled-job-coordination" title="Permanent link">&para;</a></h3>
<p>In microservices architectures where multiple instances of a service run for high availability, scheduled jobs like data backups, report generation, or maintenance tasks should only run on one instance at a time. Distributed locks ensure that these jobs don't run concurrently across multiple instances.</p>
<p>For example, a daily report generation job might acquire a distributed lock before starting processing. If multiple instances of the service are running, only one will successfully acquire the lock and perform the work, while others skip the execution or wait for the next scheduled time.</p>
<h3 id="database-migration-coordination">Database Migration Coordination<a class="headerlink" href="#database-migration-coordination" title="Permanent link">&para;</a></h3>
<p>Database schema migrations in distributed systems require careful coordination to ensure they only run once, even when multiple application instances are deployed simultaneously. Distributed locks prevent race conditions where multiple instances might attempt to run the same migration concurrently.</p>
<h3 id="critical-resource-access">Critical Resource Access<a class="headerlink" href="#critical-resource-access" title="Permanent link">&para;</a></h3>
<p>Some resources, like external payment gateways or legacy APIs, have strict concurrency limitations. Distributed locks provide a way to coordinate access to these resources across multiple services, preventing overload and ensuring fair usage.</p>
<p>For instance, an integration with a legacy mainframe system that can only handle one connection at a time would use distributed locks to coordinate access across multiple microservices that need to interact with the system.</p>
<h3 id="unique-identifier-generation">Unique Identifier Generation<a class="headerlink" href="#unique-identifier-generation" title="Permanent link">&para;</a></h3>
<p>Systems that need to generate unique identifiers (like order numbers or transaction IDs) across multiple instances can use distributed locks to coordinate the generation process. This ensures that no duplicate identifiers are created even when multiple services are generating IDs simultaneously.</p>
<h3 id="cache-warming-and-data-loading">Cache Warming and Data Loading<a class="headerlink" href="#cache-warming-and-data-loading" title="Permanent link">&para;</a></h3>
<p>Cache warming operations or bulk data loading processes often should only be performed by one instance at a time to avoid overwhelming downstream systems or creating duplicate work. Distributed locks coordinate these operations across multiple instances.</p>
<h2 id="simple-distributed-lock-implementation">Simple Distributed Lock Implementation<a class="headerlink" href="#simple-distributed-lock-implementation" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">contextmanager</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DistributedLock</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_client</span><span class="p">:</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">,</span> <span class="n">lock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                 <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">retry_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">redis_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;lock:</span><span class="si">{</span><span class="n">lock_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retry_delay</span> <span class="o">=</span> <span class="n">retry_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">acquire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blocking</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Acquire the distributed lock&quot;&quot;&quot;</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">lock_timeout</span> <span class="o">=</span> <span class="n">timeout</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">lock_timeout</span> <span class="k">if</span> <span class="n">blocking</span> <span class="k">else</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">:</span>
            <span class="c1"># Try to acquire the lock with SET NX EX</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">blocking</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retry_delay</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Release the distributed lock&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Use Lua script to ensure atomic check-and-delete</span>
        <span class="n">lua_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        if redis.call(&quot;get&quot;, KEYS[1]) == ARGV[1] then</span>
<span class="s2">            return redis.call(&quot;del&quot;, KEYS[1])</span>
<span class="s2">        else</span>
<span class="s2">            return 0</span>
<span class="s2">        end</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">lua_script</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">additional_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extend the lock expiration time&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">lua_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        if redis.call(&quot;get&quot;, KEYS[1]) == ARGV[1] then</span>
<span class="s2">            return redis.call(&quot;expire&quot;, KEYS[1], ARGV[2])</span>
<span class="s2">        else</span>
<span class="s2">            return 0</span>
<span class="s2">        end</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">lua_script</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span><span class="p">,</span> 
                               <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="n">additional_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_locked</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the lock is currently held&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context manager entry&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquire</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not acquire lock: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context manager exit&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DistributedLockManager</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_client</span><span class="p">:</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">redis_client</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">retry_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DistributedLock</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new distributed lock&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DistributedLock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">retry_delay</span><span class="p">)</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">acquire_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">blocking</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context manager for acquiring locks&quot;&quot;&quot;</span>
        <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">blocking</span><span class="o">=</span><span class="n">blocking</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">lock</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not acquire lock: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="c1"># Example usage and demonstration</span>
<span class="k">def</span><span class="w"> </span><span class="nf">demo_distributed_locks</span><span class="p">():</span>
    <span class="c1"># Connect to Redis</span>
    <span class="n">redis_client</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">lock_manager</span> <span class="o">=</span> <span class="n">DistributedLockManager</span><span class="p">(</span><span class="n">redis_client</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Basic Lock Usage ===&quot;</span><span class="p">)</span>

    <span class="c1"># Basic lock acquisition and release</span>
    <span class="n">lock</span> <span class="o">=</span> <span class="n">lock_manager</span><span class="o">.</span><span class="n">lock</span><span class="p">(</span><span class="s2">&quot;demo_resource&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lock acquired successfully&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Simulate work</span>
        <span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lock released&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to acquire lock&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Context Manager Usage ===&quot;</span><span class="p">)</span>

    <span class="c1"># Using context manager</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">lock_manager</span><span class="o">.</span><span class="n">acquire_lock</span><span class="p">(</span><span class="s2">&quot;demo_resource&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Working with locked resource...&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Work completed&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lock acquisition failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Concurrent Access Demo ===&quot;</span><span class="p">)</span>

    <span class="c1"># Simulate concurrent access</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">worker</span><span class="p">(</span><span class="n">worker_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">work_duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">lock_manager</span><span class="o">.</span><span class="n">acquire_lock</span><span class="p">(</span><span class="s2">&quot;shared_resource&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2"> acquired lock&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">work_duration</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2"> completed work&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2"> failed to acquire lock&quot;</span><span class="p">)</span>

    <span class="c1"># Start multiple workers</span>
    <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c1"># Wait for all workers to complete</span>
    <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Lock Extension Demo ===&quot;</span><span class="p">)</span>

    <span class="c1"># Demonstrate lock extension</span>
    <span class="n">lock</span> <span class="o">=</span> <span class="n">lock_manager</span><span class="o">.</span><span class="n">lock</span><span class="p">(</span><span class="s2">&quot;extendable_resource&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lock acquired with 5 second timeout&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lock</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lock extended by 10 seconds&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Additional work completed&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to extend lock&quot;</span><span class="p">)</span>

        <span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lock released&quot;</span><span class="p">)</span>

<span class="c1"># Example: Scheduled job with distributed lock</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ScheduledJobWithLock</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_client</span><span class="p">:</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">,</span> <span class="n">job_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_manager</span> <span class="o">=</span> <span class="n">DistributedLockManager</span><span class="p">(</span><span class="n">redis_client</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span> <span class="o">=</span> <span class="n">job_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;scheduled_job:</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_job</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run job with distributed lock to prevent concurrent execution&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_manager</span><span class="o">.</span><span class="n">acquire_lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting scheduled job: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_work</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed scheduled job: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="si">}</span><span class="s2"> is already running on another instance - skipping&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_do_work</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate actual job work&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing data...&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating report...&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sending notifications...&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Run the demonstration</span>
    <span class="n">demo_distributed_locks</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Scheduled Job Example ===&quot;</span><span class="p">)</span>

    <span class="c1"># Example of scheduled job with locking</span>
    <span class="n">redis_client</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">job</span> <span class="o">=</span> <span class="n">ScheduledJobWithLock</span><span class="p">(</span><span class="n">redis_client</span><span class="p">,</span> <span class="s2">&quot;daily_report&quot;</span><span class="p">)</span>

    <span class="c1"># Simulate multiple instances trying to run the same job</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_job_instance</span><span class="p">(</span><span class="n">instance_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Instance </span><span class="si">{</span><span class="n">instance_id</span><span class="si">}</span><span class="s2"> attempting to run job&quot;</span><span class="p">)</span>
        <span class="n">job</span><span class="o">.</span><span class="n">run_job</span><span class="p">()</span>

    <span class="c1"># Start multiple job instances simultaneously</span>
    <span class="n">job_threads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run_job_instance</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
        <span class="n">job_threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c1"># Wait for all instances to complete</span>
    <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">job_threads</span><span class="p">:</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All job instances completed&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="common-interview-questions">Common Interview Questions<a class="headerlink" href="#common-interview-questions" title="Permanent link">&para;</a></h2>
<p><strong>Q: What are distributed locks and when would you use them?</strong></p>
<p>Distributed locks are synchronization primitives that coordinate access to shared resources across multiple processes or nodes in a distributed system. Use them when you need to ensure only one process accesses a resource at a time across multiple machines, such as: preventing duplicate scheduled jobs across service instances, coordinating database migrations, serializing access to rate-limited APIs, generating unique identifiers across services, or ensuring single-instance operations like cache warming. They're essential when traditional thread-level locks aren't sufficient due to processes running on different machines.</p>
<p><strong>Q: What are the main challenges with implementing distributed locks?</strong></p>
<p>Key challenges include: lock expiration timing (balancing deadlock prevention with legitimate long-running operations), split-brain scenarios (network partitions causing multiple processes to think they hold the same lock), performance bottlenecks (high contention can reduce throughput), clock synchronization (time differences between nodes affect timeouts), failure detection (determining when a lock holder has crashed), and deadlock prevention (circular dependencies are harder to detect in distributed systems). The fundamental challenge is achieving coordination across unreliable networks with independent clocks.</p>
<p><strong>Q: What are different approaches to implementing distributed locks?</strong></p>
<p>Main approaches include: Database-based (using table rows with transactions, reliable but potentially slow), Redis-based (using atomic SET NX EX commands, fast but requires additional infrastructure), Consensus-based (ZooKeeper, etcd, Consul using Raft/Paxos, highly reliable but complex), and Cloud provider services (DynamoDB conditional writes, Firestore transactions, managed but potentially vendor-specific). Choose based on existing infrastructure, consistency requirements, performance needs, and operational complexity tolerance.</p>
<p><strong>Q: How do you handle lock expiration and prevent deadlocks in distributed systems?</strong></p>
<p>Handle expiration through: setting appropriate timeouts based on expected operation duration, implementing lock extension mechanisms for long-running operations, using heartbeat systems to detect failed processes, and implementing graceful degradation when locks expire unexpectedly. Prevent deadlocks through: avoiding nested lock acquisition, using consistent lock ordering when multiple locks are needed, implementing timeout-based deadlock detection, using try-lock patterns instead of blocking indefinitely, and designing operations to be idempotent when possible. The key is balancing safety (preventing resource conflicts) with liveness (avoiding permanent blocking).</p>
<h2 id="distributed-lock-best-practices">Distributed Lock Best Practices<a class="headerlink" href="#distributed-lock-best-practices" title="Permanent link">&para;</a></h2>
<h3 id="choose-appropriate-timeout-values">Choose Appropriate Timeout Values<a class="headerlink" href="#choose-appropriate-timeout-values" title="Permanent link">&para;</a></h3>
<p>Set lock timeouts based on realistic estimates of operation duration plus safety margins. Monitor actual operation times and adjust timeouts accordingly. Consider implementing dynamic timeouts based on historical performance data for different types of operations.</p>
<h3 id="implement-lock-extension-for-long-operations">Implement Lock Extension for Long Operations<a class="headerlink" href="#implement-lock-extension-for-long-operations" title="Permanent link">&para;</a></h3>
<p>For operations that might take longer than expected, implement lock extension mechanisms that allow processes to renew their locks before expiration. This prevents legitimate operations from losing locks due to conservative timeout settings.</p>
<h3 id="use-unique-identifiers-for-lock-ownership">Use Unique Identifiers for Lock Ownership<a class="headerlink" href="#use-unique-identifiers-for-lock-ownership" title="Permanent link">&para;</a></h3>
<p>Always use unique identifiers (like UUIDs) to identify lock owners and verify ownership before releasing locks. This prevents processes from accidentally releasing locks held by other processes and helps detect potential bugs in lock management logic.</p>
<h3 id="design-for-lock-failure-scenarios">Design for Lock Failure Scenarios<a class="headerlink" href="#design-for-lock-failure-scenarios" title="Permanent link">&para;</a></h3>
<p>Plan for situations where locks can't be acquired or are lost unexpectedly. Implement graceful degradation, idempotent operations where possible, and proper error handling. Consider whether operations should fail fast or retry when locks aren't available.</p>
<h3 id="monitor-lock-usage-and-performance">Monitor Lock Usage and Performance<a class="headerlink" href="#monitor-lock-usage-and-performance" title="Permanent link">&para;</a></h3>
<p>Implement comprehensive monitoring for lock acquisition times, hold durations, contention levels, and failure rates. This data helps identify performance bottlenecks, tune timeout values, and detect problematic usage patterns.</p>
<h3 id="keep-critical-sections-small">Keep Critical Sections Small<a class="headerlink" href="#keep-critical-sections-small" title="Permanent link">&para;</a></h3>
<p>Minimize the amount of work done while holding locks to reduce contention and improve overall system throughput. Prepare data and perform non-critical operations outside of locked sections when possible.</p>
<p>Distributed locks are a powerful tool for coordination in distributed systems, but they require careful design and implementation to avoid becoming performance bottlenecks or sources of system instability. When used appropriately, they enable safe resource sharing and coordination across distributed processes.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.sections", "navigation.tracking", "content.code.copy", "content.action.edit", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>