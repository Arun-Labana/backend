
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A 45-day learning plan covering essential backend concepts with beginner-friendly notes and Java examples.">
      
      
      
        <link rel="canonical" href="https://Arun-Labana.github.io/backend/30.%20JWT%20%26%20OAuth2/">
      
      
        <link rel="prev" href="../29.%20Authentication%20vs%20Authorization/">
      
      
        <link rel="next" href="../31.%20CSRF%20%26%20XSS%20Protection/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>30. JWT & OAuth2 - 45 Days Backend Concepts</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#jwt-oauth2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="45 Days Backend Concepts" class="md-header__button md-logo" aria-label="45 Days Backend Concepts" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            45 Days Backend Concepts
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              30. JWT & OAuth2
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Arun-Labana/backend" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Arun-Labana/backend
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="45 Days Backend Concepts" class="md-nav__button md-logo" aria-label="45 Days Backend Concepts" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    45 Days Backend Concepts
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Arun-Labana/backend" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Arun-Labana/backend
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Days
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Days
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01.%20Connection%20Pooling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01. Connection Pooling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02.%20Idempotency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02. Idempotency
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03.%20Caching%20%28In-Memory%20vs%20Distributed%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    03. Caching (In-Memory vs Distributed)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04.%20Load%20Balancing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    04. Load Balancing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05.%20Rate%20Limiting%20%26%20Throttling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    05. Rate Limiting & Throttling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06.%20Horizontal%20vs%20Vertical%20Scaling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    06. Horizontal vs Vertical Scaling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07.%20Stateless%20vs%20Stateful%20Architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    07. Stateless vs Stateful Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08.%20Transactions%20%28ACID%20properties%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    08. Transactions (ACID properties)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09.%20Indexes%20%28B-Tree%2C%20Hash%2C%20etc.%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    09. Indexes (B-Tree, Hash, etc.)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10.%20Joins%20%26%20Query%20Optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    10. Joins & Query Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11.%20Normalization%20vs%20Denormalization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    11. Normalization vs Denormalization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12.%20Sharding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    12. Sharding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13.%20Replication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    13. Replication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../14.%20CAP%20Theorem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    14. CAP Theorem
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../15.%20REST%20APIs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    15. REST APIs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../16.%20GraphQL%20Basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    16. GraphQL Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../17.%20gRPC%20%26%20Protocol%20Buffers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    17. gRPC & Protocol Buffers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../18.%20WebSockets%20%28Realtime%20communication%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    18. WebSockets (Realtime communication)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../19.%20Message%20Queues%20%28RabbitMQ%2C%20Kafka%2C%20SQS%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    19. Message Queues (RabbitMQ, Kafka, SQS)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../20.%20Event-driven%20Architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    20. Event-driven Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../21.%20API%20Gateway/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    21. API Gateway
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../22.%20Circuit%20Breaker%20Pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    22. Circuit Breaker Pattern
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../23.%20Retry%20%26%20Backoff%20Strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    23. Retry & Backoff Strategies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../24.%20Dead%20Letter%20Queues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    24. Dead Letter Queues
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../25.%20Distributed%20Locks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    25. Distributed Locks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../26.%20Leader%20Election/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    26. Leader Election
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../27.%20Consensus%20Algorithms%20%28Raft%2C%20Paxos%20basics%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    27. Consensus Algorithms (Raft, Paxos basics)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../28.%20Quorum%20in%20Databases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    28. Quorum in Databases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../29.%20Authentication%20vs%20Authorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    29. Authentication vs Authorization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    30. JWT & OAuth2
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    30. JWT & OAuth2
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-are-jwt-and-oauth2" class="md-nav__link">
    <span class="md-ellipsis">
      What are JWT and OAuth2?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-jwt-json-web-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding JWT (JSON Web Tokens)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding JWT (JSON Web Tokens)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwt-structure-and-components" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Structure and Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt-claims-and-security" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Claims and Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt-advantages-and-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Advantages and Limitations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-oauth2" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding OAuth2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding OAuth2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauth2-roles-and-flow" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth2 Roles and Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauth2-grant-types" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth2 Grant Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkce-proof-key-for-code-exchange" class="md-nav__link">
    <span class="md-ellipsis">
      PKCE (Proof Key for Code Exchange)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jwt-and-oauth2-integration" class="md-nav__link">
    <span class="md-ellipsis">
      JWT and OAuth2 Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JWT and OAuth2 Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-tokens-as-jwts" class="md-nav__link">
    <span class="md-ellipsis">
      Access Tokens as JWTs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#refresh-token-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Refresh Token Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-validation-and-claims" class="md-nav__link">
    <span class="md-ellipsis">
      Token Validation and Claims
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Real-World Applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-World Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-sign-on-sso-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Single Sign-On (SSO) Systems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-gateway-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      API Gateway Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mobile-application-security" class="md-nav__link">
    <span class="md-ellipsis">
      Mobile Application Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#third-party-integrations" class="md-nav__link">
    <span class="md-ellipsis">
      Third-Party Integrations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-jwt-and-oauth2-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Simple JWT and OAuth2 Implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-interview-questions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Interview Questions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jwt-and-oauth2-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      JWT and OAuth2 Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JWT and OAuth2 Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implement-proper-token-lifecycle-management" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Proper Token Lifecycle Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-token-storage-and-transmission" class="md-nav__link">
    <span class="md-ellipsis">
      Secure Token Storage and Transmission
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate-all-token-claims" class="md-nav__link">
    <span class="md-ellipsis">
      Validate All Token Claims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-comprehensive-scope-management" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Comprehensive Scope Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plan-for-scalability-and-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Plan for Scalability and Performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitor-and-audit-token-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor and Audit Token Usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../31.%20CSRF%20%26%20XSS%20Protection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    31. CSRF & XSS Protection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../32.%20SQL%20Injection%20%26%20Prevention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    32. SQL Injection & Prevention
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../33.%20HTTPS%20%26%20TLS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    33. HTTPS & TLS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../34.%20CORS%20%28Cross-Origin%20Resource%20Sharing%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    34. CORS (Cross-Origin Resource Sharing)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../35.%20Hashing%20%26%20Password%20Storage%20%28bcrypt%2C%20Argon2%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    35. Hashing & Password Storage (bcrypt, Argon2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../36.%20Logging%20Strategies%20%28Structured%20Logging%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    36. Logging Strategies (Structured Logging)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../37.%20Metrics%20%26%20Monitoring%20%28Prometheus%2C%20Grafana%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    37. Metrics & Monitoring (Prometheus, Grafana)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../38.%20Tracing%20%28Distributed%20Tracing%2C%20OpenTelemetry%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    38. Tracing (Distributed Tracing, OpenTelemetry)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../39.%20Health%20Checks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    39. Health Checks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../40.%20Profiling%20%26%20Benchmarking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    40. Profiling & Benchmarking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../41.%20Error%20Handling%20Patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    41. Error Handling Patterns
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../42.%20Blue-Green%20%26%20Canary%20Deployments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    42. Blue-Green & Canary Deployments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../43.%20CQRS%20%28Command%20Query%20Responsibility%20Segregation%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    43. CQRS (Command Query Responsibility Segregation)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../44.%20Event%20Sourcing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    44. Event Sourcing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../45.%20Microservices%20vs%20Monoliths%20vs%20Serverless/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    45. Microservices vs Monoliths vs Serverless
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-are-jwt-and-oauth2" class="md-nav__link">
    <span class="md-ellipsis">
      What are JWT and OAuth2?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-jwt-json-web-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding JWT (JSON Web Tokens)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding JWT (JSON Web Tokens)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwt-structure-and-components" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Structure and Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt-claims-and-security" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Claims and Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt-advantages-and-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Advantages and Limitations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-oauth2" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding OAuth2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding OAuth2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauth2-roles-and-flow" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth2 Roles and Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauth2-grant-types" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth2 Grant Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkce-proof-key-for-code-exchange" class="md-nav__link">
    <span class="md-ellipsis">
      PKCE (Proof Key for Code Exchange)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jwt-and-oauth2-integration" class="md-nav__link">
    <span class="md-ellipsis">
      JWT and OAuth2 Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JWT and OAuth2 Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-tokens-as-jwts" class="md-nav__link">
    <span class="md-ellipsis">
      Access Tokens as JWTs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#refresh-token-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Refresh Token Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-validation-and-claims" class="md-nav__link">
    <span class="md-ellipsis">
      Token Validation and Claims
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Real-World Applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-World Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-sign-on-sso-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Single Sign-On (SSO) Systems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-gateway-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      API Gateway Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mobile-application-security" class="md-nav__link">
    <span class="md-ellipsis">
      Mobile Application Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#third-party-integrations" class="md-nav__link">
    <span class="md-ellipsis">
      Third-Party Integrations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-jwt-and-oauth2-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Simple JWT and OAuth2 Implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-interview-questions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Interview Questions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jwt-and-oauth2-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      JWT and OAuth2 Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JWT and OAuth2 Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implement-proper-token-lifecycle-management" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Proper Token Lifecycle Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-token-storage-and-transmission" class="md-nav__link">
    <span class="md-ellipsis">
      Secure Token Storage and Transmission
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate-all-token-claims" class="md-nav__link">
    <span class="md-ellipsis">
      Validate All Token Claims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-comprehensive-scope-management" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Comprehensive Scope Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plan-for-scalability-and-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Plan for Scalability and Performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitor-and-audit-token-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor and Audit Token Usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/Arun-Labana/backend/edit/master/docs/30. JWT & OAuth2/README.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="jwt-oauth2">JWT &amp; OAuth2<a class="headerlink" href="#jwt-oauth2" title="Permanent link">&para;</a></h1>
<h2 id="what-are-jwt-and-oauth2">What are JWT and OAuth2?<a class="headerlink" href="#what-are-jwt-and-oauth2" title="Permanent link">&para;</a></h2>
<p>JWT (JSON Web Tokens) and OAuth2 are complementary technologies that work together to provide secure authentication and authorization in modern web applications and APIs. Think of OAuth2 like a valet parking system at a fancy restaurant - when you arrive, you don't give the valet your house keys or wallet, just your car keys with permission to park your car. Similarly, OAuth2 allows applications to access specific user resources without requiring the user's actual credentials. JWT is like the numbered ticket the valet gives you - it's a secure, self-contained token that proves you have the right to retrieve your car later.</p>
<p>While OAuth2 defines the authorization framework and flows for granting access permissions, JWT provides a standardized format for securely transmitting information between parties as tokens. Together, they enable secure, scalable authentication and authorization systems that support modern application architectures including single-page applications, mobile apps, and microservices.</p>
<h2 id="understanding-jwt-json-web-tokens">Understanding JWT (JSON Web Tokens)<a class="headerlink" href="#understanding-jwt-json-web-tokens" title="Permanent link">&para;</a></h2>
<h3 id="jwt-structure-and-components">JWT Structure and Components<a class="headerlink" href="#jwt-structure-and-components" title="Permanent link">&para;</a></h3>
<p>A JWT is a compact, URL-safe token that consists of three parts separated by dots: header.payload.signature. The header contains metadata about the token including the signing algorithm used. The payload contains the claims (statements about the user and additional data), and the signature ensures the token hasn't been tampered with and verifies the sender's identity.</p>
<p>Each part is Base64URL encoded, making JWTs easy to transmit in HTTP headers, URL parameters, or POST parameters. The self-contained nature of JWTs means they carry all necessary information within the token itself, eliminating the need for server-side session storage and enabling stateless authentication.</p>
<h3 id="jwt-claims-and-security">JWT Claims and Security<a class="headerlink" href="#jwt-claims-and-security" title="Permanent link">&para;</a></h3>
<p>JWT claims are statements about an entity (typically the user) and additional data. Standard claims include "iss" (issuer), "exp" (expiration time), "sub" (subject), and "aud" (audience). Custom claims can include user roles, permissions, or any other relevant information needed for authorization decisions.</p>
<p>The signature ensures JWT integrity and authenticity. When using symmetric algorithms like HMAC SHA256, the same secret key is used for both signing and verification. Asymmetric algorithms like RSA or ECDSA use a private key for signing and a public key for verification, enabling distributed verification without sharing secrets.</p>
<h3 id="jwt-advantages-and-limitations">JWT Advantages and Limitations<a class="headerlink" href="#jwt-advantages-and-limitations" title="Permanent link">&para;</a></h3>
<p>JWTs provide several advantages including stateless authentication (no server-side session storage required), scalability (tokens can be verified independently by any service), and cross-domain support (tokens work across different domains and services). They're particularly well-suited for distributed systems and microservices architectures.</p>
<p>However, JWTs also have limitations. Once issued, they cannot be easily revoked before expiration, making token compromise a concern. They can become large if they contain extensive claims, impacting performance. Token expiration must be carefully balanced between security (shorter expiration) and user experience (longer expiration to avoid frequent re-authentication).</p>
<h2 id="understanding-oauth2">Understanding OAuth2<a class="headerlink" href="#understanding-oauth2" title="Permanent link">&para;</a></h2>
<h3 id="oauth2-roles-and-flow">OAuth2 Roles and Flow<a class="headerlink" href="#oauth2-roles-and-flow" title="Permanent link">&para;</a></h3>
<p>OAuth2 defines four roles in the authorization process. The Resource Owner (typically the user) owns the data being accessed. The Client (the application) wants to access the user's data. The Authorization Server handles authentication and issues access tokens. The Resource Server hosts the protected resources and accepts access tokens.</p>
<p>The basic OAuth2 flow involves the client redirecting the user to the authorization server, the user authenticating and granting permission, the authorization server redirecting back to the client with an authorization code, and the client exchanging the code for an access token that can be used to access protected resources.</p>
<h3 id="oauth2-grant-types">OAuth2 Grant Types<a class="headerlink" href="#oauth2-grant-types" title="Permanent link">&para;</a></h3>
<p><strong>Authorization Code Grant</strong> is the most secure and commonly used flow for web applications. The client receives an authorization code that must be exchanged for tokens on the server side, keeping tokens away from the browser and potential attackers. This flow supports refresh tokens for long-term access.</p>
<p><strong>Implicit Grant</strong> was designed for public clients like single-page applications where client secrets cannot be securely stored. However, it's less secure because tokens are exposed in the browser and URL fragments. Modern best practices recommend using Authorization Code with PKCE instead.</p>
<p><strong>Client Credentials Grant</strong> is used for server-to-server authentication where the client acts on its own behalf rather than on behalf of a user. This is common for API integrations and background services that need to access resources without user interaction.</p>
<p><strong>Resource Owner Password Credentials Grant</strong> allows the client to collect the user's username and password directly. This grant type should only be used when there's high trust between the user and client, and other flows aren't feasible.</p>
<h3 id="pkce-proof-key-for-code-exchange">PKCE (Proof Key for Code Exchange)<a class="headerlink" href="#pkce-proof-key-for-code-exchange" title="Permanent link">&para;</a></h3>
<p>PKCE enhances the security of OAuth2 flows, particularly for public clients like mobile apps and single-page applications. It works by having the client generate a random code verifier and its corresponding code challenge. The code challenge is sent with the authorization request, and the code verifier is sent when exchanging the authorization code for tokens.</p>
<p>This prevents authorization code interception attacks because an attacker who intercepts the authorization code cannot exchange it for tokens without the original code verifier. PKCE is now recommended for all OAuth2 clients, not just public ones.</p>
<h2 id="jwt-and-oauth2-integration">JWT and OAuth2 Integration<a class="headerlink" href="#jwt-and-oauth2-integration" title="Permanent link">&para;</a></h2>
<h3 id="access-tokens-as-jwts">Access Tokens as JWTs<a class="headerlink" href="#access-tokens-as-jwts" title="Permanent link">&para;</a></h3>
<p>While OAuth2 doesn't specify the format of access tokens, JWTs are commonly used because they're self-contained and can carry authorization information. When an OAuth2 authorization server issues JWT access tokens, resource servers can validate and extract user information directly from the token without calling back to the authorization server.</p>
<p>This approach improves performance and scalability but requires careful consideration of token size, expiration times, and revocation strategies. JWT access tokens should have short expiration times to limit the impact of token compromise.</p>
<h3 id="refresh-token-strategy">Refresh Token Strategy<a class="headerlink" href="#refresh-token-strategy" title="Permanent link">&para;</a></h3>
<p>Refresh tokens provide a way to obtain new access tokens without requiring user re-authentication. They're typically longer-lived than access tokens and are used to maintain user sessions while keeping access tokens short-lived for security.</p>
<p>When using JWTs as access tokens, refresh tokens become crucial for managing token lifecycle. The client can use a refresh token to obtain a new JWT access token when the current one expires, providing a balance between security and user experience.</p>
<h3 id="token-validation-and-claims">Token Validation and Claims<a class="headerlink" href="#token-validation-and-claims" title="Permanent link">&para;</a></h3>
<p>Resource servers must validate JWT tokens by verifying the signature, checking expiration times, and validating claims like issuer and audience. The token's claims can then be used to make authorization decisions without additional database lookups.</p>
<p>This distributed validation capability is particularly valuable in microservices architectures where multiple services need to make authorization decisions independently while maintaining consistent security policies.</p>
<h2 id="real-world-applications">Real-World Applications<a class="headerlink" href="#real-world-applications" title="Permanent link">&para;</a></h2>
<h3 id="single-sign-on-sso-systems">Single Sign-On (SSO) Systems<a class="headerlink" href="#single-sign-on-sso-systems" title="Permanent link">&para;</a></h3>
<p>Enterprise SSO systems use OAuth2 flows to enable users to authenticate once and access multiple applications. When a user logs into the corporate portal, they receive JWT tokens that can be used to access various internal applications without additional authentication.</p>
<p>The JWT tokens contain user identity information and role assignments that applications can use to customize the user experience and enforce authorization policies. This approach reduces password fatigue and improves security by centralizing authentication.</p>
<h3 id="api-gateway-authentication">API Gateway Authentication<a class="headerlink" href="#api-gateway-authentication" title="Permanent link">&para;</a></h3>
<p>API gateways often use JWT tokens issued through OAuth2 flows to authenticate and authorize API requests. Clients obtain JWT tokens from an OAuth2 authorization server and include them in API requests. The gateway validates the tokens and extracts user information for rate limiting, logging, and routing decisions.</p>
<p>This pattern enables fine-grained API access control while maintaining high performance through stateless token validation. Different client applications can have different scopes and permissions encoded in their JWT tokens.</p>
<h3 id="mobile-application-security">Mobile Application Security<a class="headerlink" href="#mobile-application-security" title="Permanent link">&para;</a></h3>
<p>Mobile applications use OAuth2 with PKCE to securely authenticate users and access backend APIs. The mobile app redirects users to the authorization server through the system browser, receives an authorization code, and exchanges it for JWT tokens using PKCE for additional security.</p>
<p>The JWT tokens are stored securely on the device and included in API requests. Short-lived access tokens with refresh token rotation provide a good balance between security and user experience for mobile applications.</p>
<h3 id="third-party-integrations">Third-Party Integrations<a class="headerlink" href="#third-party-integrations" title="Permanent link">&para;</a></h3>
<p>OAuth2 enables secure third-party integrations where external applications can access user data with explicit permission. For example, a photo printing service can use OAuth2 to access a user's photos from a cloud storage provider without requiring the user's storage credentials.</p>
<p>The OAuth2 flow ensures users maintain control over their data by explicitly granting permissions, and JWT tokens can include scope limitations that restrict what data the third-party application can access.</p>
<h2 id="simple-jwt-and-oauth2-implementation">Simple JWT and OAuth2 Implementation<a class="headerlink" href="#simple-jwt-and-oauth2-implementation" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">jwt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GrantType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">AUTHORIZATION_CODE</span> <span class="o">=</span> <span class="s2">&quot;authorization_code&quot;</span>
    <span class="n">CLIENT_CREDENTIALS</span> <span class="o">=</span> <span class="s2">&quot;client_credentials&quot;</span>
    <span class="n">REFRESH_TOKEN</span> <span class="o">=</span> <span class="s2">&quot;refresh_token&quot;</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OAuthClient</span><span class="p">:</span>
    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">redirect_uris</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">scopes</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">grant_types</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">GrantType</span><span class="p">]</span>
    <span class="n">is_public</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AuthorizationCode</span><span class="p">:</span>
    <span class="n">code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">scopes</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">redirect_uri</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">expires_at</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">code_challenge</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">code_challenge_method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AccessToken</span><span class="p">:</span>
    <span class="n">token</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">scopes</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">expires_at</span><span class="p">:</span> <span class="n">datetime</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RefreshToken</span><span class="p">:</span>
    <span class="n">token</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">scopes</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">expires_at</span><span class="p">:</span> <span class="n">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">JWTService</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">issuer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auth-server&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">secret_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">issuer</span> <span class="o">=</span> <span class="n">issuer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="s2">&quot;HS256&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
                           <span class="n">expires_in</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a JWT access token&quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;iss&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">issuer</span><span class="p">,</span>
            <span class="s1">&#39;sub&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s1">&#39;aud&#39;</span><span class="p">:</span> <span class="n">client_id</span><span class="p">,</span>
            <span class="s1">&#39;iat&#39;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
            <span class="s1">&#39;exp&#39;</span><span class="p">:</span> <span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">expires_in</span><span class="p">),</span>
            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scopes</span><span class="p">),</span>
            <span class="s1">&#39;token_type&#39;</span><span class="p">:</span> <span class="s1">&#39;access_token&#39;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_refresh_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                           <span class="n">expires_in</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">86400</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># 30 days</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a JWT refresh token&quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;iss&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">issuer</span><span class="p">,</span>
            <span class="s1">&#39;sub&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s1">&#39;aud&#39;</span><span class="p">:</span> <span class="n">client_id</span><span class="p">,</span>
            <span class="s1">&#39;iat&#39;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
            <span class="s1">&#39;exp&#39;</span><span class="p">:</span> <span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">expires_in</span><span class="p">),</span>
            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scopes</span><span class="p">),</span>
            <span class="s1">&#39;token_type&#39;</span><span class="p">:</span> <span class="s1">&#39;refresh_token&#39;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate and decode a JWT token&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span> <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">])</span>

            <span class="c1"># Check if token is expired</span>
            <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]):</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">payload</span>
        <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">InvalidTokenError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract scopes from a JWT token&quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">payload</span> <span class="ow">and</span> <span class="s1">&#39;scope&#39;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;scope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OAuth2Server</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jwt_service</span><span class="p">:</span> <span class="n">JWTService</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span> <span class="o">=</span> <span class="n">jwt_service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OAuthClient</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authorization_codes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AuthorizationCode</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;user1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;john&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;password123&#39;</span><span class="p">},</span>
            <span class="s1">&#39;user2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;jane&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;password456&#39;</span><span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">OAuthClient</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register an OAuth2 client&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="o">.</span><span class="n">client_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Registered OAuth2 client: </span><span class="si">{</span><span class="n">client</span><span class="o">.</span><span class="n">client_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_code_challenge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code_verifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate PKCE code challenge from verifier&quot;&quot;&quot;</span>
        <span class="n">digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">code_verifier</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="n">digest</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">authorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">redirect_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                 <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">code_challenge</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">code_challenge_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle authorization request and return authorization code&quot;&quot;&quot;</span>

        <span class="c1"># Validate client</span>
        <span class="k">if</span> <span class="n">client_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid client_id&quot;</span><span class="p">)</span>

        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client_id</span><span class="p">]</span>

        <span class="c1"># Validate redirect URI</span>
        <span class="k">if</span> <span class="n">redirect_uri</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">redirect_uris</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid redirect_uri&quot;</span><span class="p">)</span>

        <span class="c1"># Validate scopes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scopes</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">scopes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid scopes&quot;</span><span class="p">)</span>

        <span class="c1"># Generate authorization code</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>

        <span class="n">auth_code</span> <span class="o">=</span> <span class="n">AuthorizationCode</span><span class="p">(</span>
            <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span>
            <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">scopes</span><span class="o">=</span><span class="n">scopes</span><span class="p">,</span>
            <span class="n">redirect_uri</span><span class="o">=</span><span class="n">redirect_uri</span><span class="p">,</span>
            <span class="n">expires_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
            <span class="n">code_challenge</span><span class="o">=</span><span class="n">code_challenge</span><span class="p">,</span>
            <span class="n">code_challenge_method</span><span class="o">=</span><span class="n">code_challenge_method</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">authorization_codes</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth_code</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated authorization code for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, client </span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">code</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exchange_code_for_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                               <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">redirect_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                               <span class="n">code_verifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exchange authorization code for access and refresh tokens&quot;&quot;&quot;</span>

        <span class="c1"># Validate client credentials</span>
        <span class="k">if</span> <span class="n">client_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid client&quot;</span><span class="p">)</span>

        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">is_public</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">!=</span> <span class="n">client_secret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid client credentials&quot;</span><span class="p">)</span>

        <span class="c1"># Validate authorization code</span>
        <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorization_codes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid authorization code&quot;</span><span class="p">)</span>

        <span class="n">auth_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorization_codes</span><span class="p">[</span><span class="n">code</span><span class="p">]</span>

        <span class="c1"># Check expiration</span>
        <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">auth_code</span><span class="o">.</span><span class="n">expires_at</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorization_codes</span><span class="p">[</span><span class="n">code</span><span class="p">]</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Authorization code expired&quot;</span><span class="p">)</span>

        <span class="c1"># Validate client and redirect URI</span>
        <span class="k">if</span> <span class="n">auth_code</span><span class="o">.</span><span class="n">client_id</span> <span class="o">!=</span> <span class="n">client_id</span> <span class="ow">or</span> <span class="n">auth_code</span><span class="o">.</span><span class="n">redirect_uri</span> <span class="o">!=</span> <span class="n">redirect_uri</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid authorization code&quot;</span><span class="p">)</span>

        <span class="c1"># Validate PKCE if present</span>
        <span class="k">if</span> <span class="n">auth_code</span><span class="o">.</span><span class="n">code_challenge</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">code_verifier</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Code verifier required&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">auth_code</span><span class="o">.</span><span class="n">code_challenge_method</span> <span class="o">==</span> <span class="s2">&quot;S256&quot;</span><span class="p">:</span>
                <span class="n">expected_challenge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_code_challenge</span><span class="p">(</span><span class="n">code_verifier</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">auth_code</span><span class="o">.</span><span class="n">code_challenge</span> <span class="o">!=</span> <span class="n">expected_challenge</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid code verifier&quot;</span><span class="p">)</span>

        <span class="c1"># Generate tokens</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span><span class="o">.</span><span class="n">create_access_token</span><span class="p">(</span>
            <span class="n">auth_code</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">auth_code</span><span class="o">.</span><span class="n">scopes</span>
        <span class="p">)</span>

        <span class="n">refresh_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span><span class="o">.</span><span class="n">create_refresh_token</span><span class="p">(</span>
            <span class="n">auth_code</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">auth_code</span><span class="o">.</span><span class="n">scopes</span>
        <span class="p">)</span>

        <span class="c1"># Clean up authorization code</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorization_codes</span><span class="p">[</span><span class="n">code</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Issued tokens for user </span><span class="si">{</span><span class="n">auth_code</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, client </span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;access_token&#39;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span>
            <span class="s1">&#39;refresh_token&#39;</span><span class="p">:</span> <span class="n">refresh_token</span><span class="p">,</span>
            <span class="s1">&#39;token_type&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expires_in&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>
            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">auth_code</span><span class="o">.</span><span class="n">scopes</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                           <span class="n">refresh_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh access token using refresh token&quot;&quot;&quot;</span>

        <span class="c1"># Validate client</span>
        <span class="k">if</span> <span class="n">client_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid client&quot;</span><span class="p">)</span>

        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">is_public</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">!=</span> <span class="n">client_secret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid client credentials&quot;</span><span class="p">)</span>

        <span class="c1"># Validate refresh token</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span><span class="o">.</span><span class="n">validate_token</span><span class="p">(</span><span class="n">refresh_token</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span> <span class="ow">or</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token_type&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;refresh_token&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid refresh token&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;aud&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">client_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Token not issued for this client&quot;</span><span class="p">)</span>

        <span class="c1"># Generate new access token</span>
        <span class="n">scopes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;scope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span><span class="o">.</span><span class="n">create_access_token</span><span class="p">(</span>
            <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">],</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">scopes</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Refreshed access token for user </span><span class="si">{</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, client </span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;access_token&#39;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span>
            <span class="s1">&#39;token_type&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expires_in&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>
            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;scope&#39;</span><span class="p">]</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">client_credentials_grant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                               <span class="n">scopes</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle client credentials grant for machine-to-machine auth&quot;&quot;&quot;</span>

        <span class="c1"># Validate client</span>
        <span class="k">if</span> <span class="n">client_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid client&quot;</span><span class="p">)</span>

        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">client</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">!=</span> <span class="n">client_secret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid client credentials&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">GrantType</span><span class="o">.</span><span class="n">CLIENT_CREDENTIALS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">grant_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Client credentials grant not allowed&quot;</span><span class="p">)</span>

        <span class="c1"># Validate scopes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scopes</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">scopes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid scopes&quot;</span><span class="p">)</span>

        <span class="c1"># Generate access token (no user context)</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span><span class="o">.</span><span class="n">create_access_token</span><span class="p">(</span>
            <span class="n">client_id</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">scopes</span>  <span class="c1"># Use client_id as subject for machine auth</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Issued client credentials token for client </span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;access_token&#39;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span>
            <span class="s1">&#39;token_type&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expires_in&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>
            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scopes</span><span class="p">)</span>
        <span class="p">}</span>

<span class="c1"># Resource server for validating tokens and serving protected resources</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ResourceServer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jwt_service</span><span class="p">:</span> <span class="n">JWTService</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span> <span class="o">=</span> <span class="n">jwt_service</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">authorization_header</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">required_scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate incoming request with JWT token&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">authorization_header</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">authorization_header</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Bearer &#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing or invalid authorization header&quot;</span><span class="p">)</span>

        <span class="n">token</span> <span class="o">=</span> <span class="n">authorization_header</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>  <span class="c1"># Remove &#39;Bearer &#39; prefix</span>

        <span class="c1"># Validate token</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span><span class="o">.</span><span class="n">validate_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid or expired token&quot;</span><span class="p">)</span>

        <span class="c1"># Check required scope</span>
        <span class="k">if</span> <span class="n">required_scope</span><span class="p">:</span>
            <span class="n">token_scopes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scope&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">required_scope</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">token_scopes</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Insufficient scope. Required: </span><span class="si">{</span><span class="n">required_scope</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">payload</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_user_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">authorization_header</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Protected endpoint that requires &#39;profile&#39; scope&quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_request</span><span class="p">(</span><span class="n">authorization_header</span><span class="p">,</span> <span class="s1">&#39;profile&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">],</span>
            <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;aud&#39;</span><span class="p">],</span>
            <span class="s1">&#39;scopes&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;scope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;This is protected user profile data&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_admin_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">authorization_header</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Protected endpoint that requires &#39;admin&#39; scope&quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_request</span><span class="p">(</span><span class="n">authorization_header</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">],</span>
            <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;aud&#39;</span><span class="p">],</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;This is protected admin data&#39;</span>
        <span class="p">}</span>

<span class="c1"># Demonstration of JWT and OAuth2 integration</span>
<span class="k">def</span><span class="w"> </span><span class="nf">demo_jwt_oauth2</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== JWT &amp; OAuth2 Demo ===&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize services</span>
    <span class="n">jwt_service</span> <span class="o">=</span> <span class="n">JWTService</span><span class="p">(</span><span class="s2">&quot;secret_key_for_jwt_signing&quot;</span><span class="p">)</span>
    <span class="n">oauth_server</span> <span class="o">=</span> <span class="n">OAuth2Server</span><span class="p">(</span><span class="n">jwt_service</span><span class="p">)</span>
    <span class="n">resource_server</span> <span class="o">=</span> <span class="n">ResourceServer</span><span class="p">(</span><span class="n">jwt_service</span><span class="p">)</span>

    <span class="c1"># Register OAuth2 clients</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Client Registration ===&quot;</span><span class="p">)</span>

    <span class="n">web_client</span> <span class="o">=</span> <span class="n">OAuthClient</span><span class="p">(</span>
        <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;web_app_123&quot;</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="o">=</span><span class="s2">&quot;web_secret_456&quot;</span><span class="p">,</span>
        <span class="n">redirect_uris</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;https://webapp.example.com/callback&quot;</span><span class="p">],</span>
        <span class="n">scopes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;profile&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">},</span>
        <span class="n">grant_types</span><span class="o">=</span><span class="p">{</span><span class="n">GrantType</span><span class="o">.</span><span class="n">AUTHORIZATION_CODE</span><span class="p">,</span> <span class="n">GrantType</span><span class="o">.</span><span class="n">REFRESH_TOKEN</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="n">api_client</span> <span class="o">=</span> <span class="n">OAuthClient</span><span class="p">(</span>
        <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;api_service_789&quot;</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="o">=</span><span class="s2">&quot;api_secret_abc&quot;</span><span class="p">,</span>
        <span class="n">redirect_uris</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">scopes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;api_access&quot;</span><span class="p">},</span>
        <span class="n">grant_types</span><span class="o">=</span><span class="p">{</span><span class="n">GrantType</span><span class="o">.</span><span class="n">CLIENT_CREDENTIALS</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="n">oauth_server</span><span class="o">.</span><span class="n">register_client</span><span class="p">(</span><span class="n">web_client</span><span class="p">)</span>
    <span class="n">oauth_server</span><span class="o">.</span><span class="n">register_client</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="c1"># Authorization Code Flow</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Authorization Code Flow ===&quot;</span><span class="p">)</span>

    <span class="c1"># Step 1: Get authorization code</span>
    <span class="n">auth_code</span> <span class="o">=</span> <span class="n">oauth_server</span><span class="o">.</span><span class="n">authorize</span><span class="p">(</span>
        <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;web_app_123&quot;</span><span class="p">,</span>
        <span class="n">redirect_uri</span><span class="o">=</span><span class="s2">&quot;https://webapp.example.com/callback&quot;</span><span class="p">,</span>
        <span class="n">scopes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;profile&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">},</span>
        <span class="n">user_id</span><span class="o">=</span><span class="s2">&quot;user1&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authorization code: </span><span class="si">{</span><span class="n">auth_code</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

    <span class="c1"># Step 2: Exchange code for tokens</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">oauth_server</span><span class="o">.</span><span class="n">exchange_code_for_tokens</span><span class="p">(</span>
        <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;web_app_123&quot;</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="o">=</span><span class="s2">&quot;web_secret_456&quot;</span><span class="p">,</span>
        <span class="n">code</span><span class="o">=</span><span class="n">auth_code</span><span class="p">,</span>
        <span class="n">redirect_uri</span><span class="o">=</span><span class="s2">&quot;https://webapp.example.com/callback&quot;</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access token issued: </span><span class="si">{</span><span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">][:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Refresh token issued: </span><span class="si">{</span><span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">][:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

    <span class="c1"># Step 3: Use access token to access protected resource</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Accessing Protected Resources ===&quot;</span><span class="p">)</span>

    <span class="n">auth_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">profile_data</span> <span class="o">=</span> <span class="n">resource_server</span><span class="o">.</span><span class="n">get_user_profile</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Profile data: </span><span class="si">{</span><span class="n">profile_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access denied: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">admin_data</span> <span class="o">=</span> <span class="n">resource_server</span><span class="o">.</span><span class="n">get_admin_data</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Admin data: </span><span class="si">{</span><span class="n">admin_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access denied: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 4: Refresh access token</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Token Refresh ===&quot;</span><span class="p">)</span>

    <span class="n">new_tokens</span> <span class="o">=</span> <span class="n">oauth_server</span><span class="o">.</span><span class="n">refresh_access_token</span><span class="p">(</span>
        <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;web_app_123&quot;</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="o">=</span><span class="s2">&quot;web_secret_456&quot;</span><span class="p">,</span>
        <span class="n">refresh_token</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New access token: </span><span class="si">{</span><span class="n">new_tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">][:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

    <span class="c1"># Client Credentials Flow</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Client Credentials Flow ===&quot;</span><span class="p">)</span>

    <span class="n">client_tokens</span> <span class="o">=</span> <span class="n">oauth_server</span><span class="o">.</span><span class="n">client_credentials_grant</span><span class="p">(</span>
        <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;api_service_789&quot;</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="o">=</span><span class="s2">&quot;api_secret_abc&quot;</span><span class="p">,</span>
        <span class="n">scopes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;api_access&quot;</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Client credentials token: </span><span class="si">{</span><span class="n">client_tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">][:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

    <span class="c1"># Use client credentials token</span>
    <span class="n">client_auth_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">client_tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">admin_data</span> <span class="o">=</span> <span class="n">resource_server</span><span class="o">.</span><span class="n">get_admin_data</span><span class="p">(</span><span class="n">client_auth_header</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Admin data (client credentials): </span><span class="si">{</span><span class="n">admin_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access denied: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">demo_jwt_oauth2</span><span class="p">()</span>
</code></pre></div>

<h2 id="common-interview-questions">Common Interview Questions<a class="headerlink" href="#common-interview-questions" title="Permanent link">&para;</a></h2>
<p><strong>Q: What's the difference between JWT and OAuth2, and how do they work together?</strong></p>
<p>OAuth2 is an authorization framework that defines how applications can securely access user resources, while JWT is a token format for securely transmitting information. OAuth2 defines the flows and protocols for obtaining access tokens, while JWT defines how those tokens can be structured and validated. They work together when OAuth2 authorization servers issue JWT-formatted access tokens, enabling stateless authentication where resource servers can validate tokens locally without calling back to the authorization server. OAuth2 handles the "how to get permission" while JWT handles the "how to prove permission."</p>
<p><strong>Q: What are the main OAuth2 grant types and when would you use each?</strong></p>
<p>Authorization Code Grant: Most secure, used for web applications with server-side components. Supports refresh tokens and keeps tokens away from browsers. Implicit Grant: Originally for SPAs, now deprecated in favor of Authorization Code with PKCE due to security concerns. Client Credentials Grant: For machine-to-machine authentication where the application acts on its own behalf, not a user's. Resource Owner Password Credentials: Direct username/password collection, only for highly trusted applications. PKCE (Proof Key for Code Exchange): Security extension for public clients like mobile apps and SPAs, now recommended for all clients.</p>
<p><strong>Q: What are the security considerations when using JWTs?</strong></p>
<p>Key security considerations include: Token storage (secure storage on client side, avoid localStorage for sensitive tokens), token expiration (balance security vs UX, use short-lived access tokens with refresh tokens), signature verification (always validate signatures and standard claims like exp, iss, aud), secret management (protect signing keys, use strong algorithms), token revocation (JWTs can't be easily revoked, so use short expiration times), and information disclosure (don't put sensitive data in JWT payload as it's only base64 encoded). Consider using opaque tokens for highly sensitive applications where revocation is critical.</p>
<p><strong>Q: How do you handle token refresh and revocation in JWT-based systems?</strong></p>
<p>Token refresh uses refresh tokens to obtain new access tokens without user re-authentication. Implement short-lived access tokens (15-60 minutes) with longer-lived refresh tokens (days/weeks). Use refresh token rotation where each refresh operation issues a new refresh token and invalidates the old one. For revocation, maintain a blacklist of revoked tokens (though this reduces statelessness benefits), use short expiration times to limit exposure, implement logout endpoints that invalidate refresh tokens, and consider using opaque tokens for critical operations that require immediate revocation. Monitor for suspicious token usage patterns and implement automatic revocation triggers.</p>
<h2 id="jwt-and-oauth2-best-practices">JWT and OAuth2 Best Practices<a class="headerlink" href="#jwt-and-oauth2-best-practices" title="Permanent link">&para;</a></h2>
<h3 id="implement-proper-token-lifecycle-management">Implement Proper Token Lifecycle Management<a class="headerlink" href="#implement-proper-token-lifecycle-management" title="Permanent link">&para;</a></h3>
<p>Use short-lived access tokens (15-60 minutes) combined with longer-lived refresh tokens to balance security and user experience. Implement refresh token rotation where each refresh operation issues new tokens and invalidates old ones. Store refresh tokens securely and implement proper logout procedures that invalidate all tokens.</p>
<h3 id="secure-token-storage-and-transmission">Secure Token Storage and Transmission<a class="headerlink" href="#secure-token-storage-and-transmission" title="Permanent link">&para;</a></h3>
<p>Store tokens securely on the client side using appropriate mechanisms for each platform (secure HTTP-only cookies for web, keychain/keystore for mobile). Always transmit tokens over HTTPS and include proper security headers. Avoid storing sensitive information in JWT payloads since they're only base64 encoded, not encrypted.</p>
<h3 id="validate-all-token-claims">Validate All Token Claims<a class="headerlink" href="#validate-all-token-claims" title="Permanent link">&para;</a></h3>
<p>Always validate JWT signatures, expiration times, issuer, audience, and other standard claims. Implement proper error handling for invalid or expired tokens. Use strong signing algorithms (RS256 or ES256 for asymmetric, HS256 minimum for symmetric) and protect signing keys appropriately.</p>
<h3 id="implement-comprehensive-scope-management">Implement Comprehensive Scope Management<a class="headerlink" href="#implement-comprehensive-scope-management" title="Permanent link">&para;</a></h3>
<p>Design granular scopes that follow the principle of least privilege. Validate scopes at both the authorization server and resource server levels. Document scope meanings clearly and implement scope inheritance hierarchies where appropriate. Monitor scope usage to identify potential security issues or over-privileging.</p>
<h3 id="plan-for-scalability-and-performance">Plan for Scalability and Performance<a class="headerlink" href="#plan-for-scalability-and-performance" title="Permanent link">&para;</a></h3>
<p>Design token validation to be efficient and scalable. Cache public keys for JWT validation, implement proper token introspection endpoints for opaque tokens, and consider the performance impact of token size. Use appropriate caching strategies for authorization decisions while maintaining security.</p>
<h3 id="monitor-and-audit-token-usage">Monitor and Audit Token Usage<a class="headerlink" href="#monitor-and-audit-token-usage" title="Permanent link">&para;</a></h3>
<p>Implement comprehensive logging for token issuance, validation, and usage. Monitor for suspicious patterns like token reuse, unusual scope requests, or high refresh rates. Set up alerting for security events and maintain audit trails for compliance requirements.</p>
<p>JWT and OAuth2 together provide a powerful foundation for modern authentication and authorization systems. Understanding their proper implementation, security considerations, and best practices is essential for building secure, scalable applications that can handle diverse client types and integration scenarios while maintaining user privacy and system security.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.sections", "navigation.tracking", "content.code.copy", "content.action.edit", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>